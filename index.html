<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ESTELAR - PattitexTEC</title>
<style>
/* fuente opcional */
@font-face{font-family:MiFuenteCustom;src:url('./asset/fuente.ttf') format('truetype');}
*{box-sizing:border-box;margin:0;padding:0;}
html,body{height:100%;}
body{
  background:#000;color:#fff;font-family:MiFuenteCustom,Arial,Helvetica,sans-serif;
  -webkit-tap-highlight-color:transparent;user-select:none;overflow:hidden;
}
#transition-layer{position:fixed;inset:0;background:#000;z-index:1200;pointer-events:none;opacity:0;transition:opacity .7s ease;}
.screen{position:absolute;inset:0;display:none;flex-direction:column;align-items:center;justify-content:center}
#menu-screen{display:flex;z-index:10}
#game-screen{z-index:5}
h1{font-size:3.4rem;color:#00ffcc;text-shadow:0 0 18px #00ffcc;margin-bottom:18px;text-align:center;}
.btn-main{margin-top:14px;padding:16px 56px;font-size:1.2rem;border-radius:50px;border:3px solid #00ffcc;color:#00ffcc;background:rgba(0,255,204,0.06);cursor:pointer;box-shadow:0 0 12px rgba(0,255,204,0.18);transition:transform .12s,background .12s,color .12s;pointer-events:auto;}
.btn-main:active{transform:scale(.96);background:#00ffcc;color:#000}
#ui{position:absolute;top:18px;width:100%;display:flex;justify-content:space-between;padding:0 22px;z-index:60;pointer-events:none;align-items:center}
#score{font-size:26px;color:#00ffcc;pointer-events:none;font-weight:bold;}
.ui-controls{display:flex;gap:10px;align-items:center;pointer-events:auto}
.small-btn{padding:8px 12px;border-radius:12px;border:2px solid #00ffcc;background:rgba(0,255,204,0.06);color:#00ffcc;cursor:pointer;font-size:14px}
#overlay-menu{position:fixed;inset:0;background:rgba(0,0,0,0.92);display:none;flex-direction:column;align-items:center;justify-content:center;z-index:200;}
#overlay-menu h2{font-size:2.6rem;margin-bottom:18px;text-align:center;}
#overlay-menu .btn-row{display:flex;gap:12px;flex-wrap:wrap;justify-content:center}
#game-canvas{display:block;width:100%;height:100%;background:linear-gradient(180deg,#000011 0%,#000000 100%);}
.controls{position:absolute;bottom:26px;width:100%;display:flex;justify-content:space-around;z-index:60;pointer-events:none}
.ctrl-btn{width:86px;height:86px;border-radius:50%;display:flex;align-items:center;justify-content:center;border:3px solid #00ffcc;background:rgba(0,255,204,0.06);color:#00ffcc;font-size:34px;pointer-events:auto;user-select:none;}
.ctrl-btn:active{background:rgba(0,255,204,0.3);}
#menu-stars{position:absolute;inset:0;z-index:-1;}
#general-modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.7);z-index:1000}
.general-card{width:min(760px,94%);max-width:760px;background:linear-gradient(180deg,#080808,#0f0f0f);border-radius:14px;padding:18px;border:2px solid rgba(0,255,204,0.1);box-shadow:0 10px 40px rgba(0,0,0,0.6);color:#eafff5}
.general-header{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;}
.general-header h3{color:#00ffd0;margin:0}
.meta-row{display:flex;gap:12px;align-items:center;margin-top:12px}
.small-info{font-size:.92rem;color:#cfeee6}
.tiktok-badge{display:flex;gap:8px;align-items:center;font-size:.95rem}
@media (max-width:520px){
  h1{font-size:2.4rem}
  .btn-main{padding:12px 42px;font-size:1rem}
  .ctrl-btn{width:68px;height:68px;font-size:26px}
  .general-card{padding:14px}
  .general-header{flex-direction:column;align-items:flex-start;}
}
</style>
</head>
<body>

<div id="transition-layer"></div>

<div id="menu-screen" class="screen" aria-label="menu principal">
  <canvas id="menu-stars"></canvas>
  <h1>ESTELAR</h1>
  <button class="btn-main" onclick="startToGame()">JUGAR</button>
  <button class="btn-main" style="margin-top:16px;font-size:1rem;padding:12px 40px" onclick="showGeneral()">GENERAL</button>
  <div style="position:absolute;bottom:18px;font-size:.82rem;color:#9fded0;opacity:.9">v0.1 α — PattitexTEC</div>
</div>

<div id="game-screen" class="screen" aria-label="pantalla de juego" style="display:none">
  <div id="ui">
    <div id="score">0</div>
    <div class="ui-controls" role="toolbar">
      <button class="small-btn" onclick="togglePause()" style="pointer-events:auto">PAUSA</button>
    </div>
  </div>

  <div id="overlay-menu" role="dialog" aria-hidden="true">
    <h2 id="overlay-title">PAUSA</h2>
    <div class="btn-row">
      <button class="btn-main" id="btn-resume" onclick="togglePause()">REANUDAR</button>
      <button class="btn-main" style="background:#333;color:#fff;border-color:#555" onclick="gameToMenu()">SALIR</button>
      <button class="btn-main" style="background:#111;color:#fff;border-color:#777" onclick="restartGame()">REINICIAR</button>
    </div>
  </div>

  <canvas id="game-canvas" aria-label="canvas de juego"></canvas>

  <div class="controls">
    <div class="ctrl-btn" id="l-btn">◀</div>
    <div class="ctrl-btn" id="r-btn">▶</div>
  </div>
</div>

<div id="general-modal" role="dialog" aria-modal="true" aria-labelledby="general-title">
  <div class="general-card" role="document">
    <div class="general-header">
      <div>
        <h3 id="general-title">GENERAL</h3>
        <div class="meta-row">
          <div class="small-info"><strong>Quién lo creó:</strong> PattitexTEC</div>
        </div>
        <div class="meta-row">
          <div class="small-info"><strong>Comienzo:</strong> 23 de Febrero de 2026</div>
        </div>
        <div style="margin-top:10px" class="small-info"><strong>Versión:</strong> 0.1 α — Proyecto en desarrollo</div>
      </div>

      <div style="min-width:140px;text-align:right;margin-top:10px;">
        <div class="tiktok-badge" title="TikTok">
          <svg viewBox="0 0 48 48" width="20" height="20" aria-hidden="true">
            <path fill="#00ffdd" d="M33.5 10.7v12.8c0 0-1.3-.1-3.5-.1-2.9 0-5.9.6-8.3 1.9-2.3 1.2-4.1 3.1-4.9 5.5-1 3.1-.1 6.6 2.2 8.8 2.3 2.3 5.6 3.1 8.7 2.1 3-.9 5.4-3.4 6.2-6.4.2-.7.3-1.4.3-2.1V22.2h4.3v18.7c0 4.2-3.4 7.6-7.6 7.6-3.3 0-6.1-2-7.2-4.8-1.3-3.6.1-7.6 3.3-9.6 2.3-1.5 5.1-1.8 7.6-1.1V10.7z"/>
          </svg>
          <div style="text-align:left">
            <div style="font-weight:700">Doryan5B</div>
            <div style="font-size:.78rem;opacity:.9">@nsbewvss</div>
          </div>
        </div>
        <div style="margin-top:10px">
          <button class="small-btn" onclick="copyCreator()" style="width:100%">Copiar creador</button>
          <button class="small-btn" onclick="openSocial()" style="width:100%;margin-top:8px">Ir a TikTok</button>
        </div>
      </div>
    </div>

    <div style="margin-top:14px;color:#cfeee6;font-size:.94rem">
      <p>Notas rápidas: Este proyecto está activo y en desarrollo. Cambios frecuentes.</p>
      <p style="font-size:.82rem;opacity:.85;margin-top:6px">Última actualización: 23 Feb 2026</p>
    </div>

    <div style="display:flex;justify-content:space-between;gap:12px;margin-top:16px;align-items:center">
      <div style="font-size:.86rem;color:#9fded0">Licencia: MIT (placeholder)</div>
      <button class="btn-main" style="padding:8px 18px;font-size:.9rem" onclick="hideGeneral()">CERRAR</button>
    </div>
  </div>
</div>

<script>
/* ---------------------------
   Audio (opcional: si no tienes archivos, no falla)
   --------------------------- */
const menuMusic = new Audio('asset/music/menu.mp3');
const gameMusic = new Audio('asset/music/game.mp3');
menuMusic.loop = true; gameMusic.loop = true;

/* autoplay attempt (silenced if bloqueado) */
window.addEventListener('load', ()=>{ menuMusic.play().catch(()=>{}); });

/* simple fade */
function fadeAudio(outAudio, inAudio){
  try{
    let ov = outAudio.volume ?? 1;
    const fo = setInterval(()=>{
      ov -= 0.06;
      if(ov <= 0.05){ outAudio.pause(); outAudio.volume = 1; clearInterval(fo); }
      else outAudio.volume = Math.max(0,ov);
    }, 60);
    inAudio.volume = 0;
    inAudio.play().catch(()=>{});
    let iv = 0;
    const fi = setInterval(()=>{
      iv += 0.06;
      inAudio.volume = Math.min(0.6, iv);
      if(iv >= 0.6) clearInterval(fi);
    }, 80);
  }catch(e){}
}

/* ---------------------------
   Menu stars (simple)
   --------------------------- */
const ms = document.getElementById('menu-stars');
const mctx = ms.getContext('2d');
function resizeMenuStars(){ ms.width = window.innerWidth; ms.height = window.innerHeight; }
resizeMenuStars();
let mStars = Array.from({length:120}, ()=>({x:Math.random()*ms.width,y:Math.random()*ms.height,s:Math.random()*2+0.4,v:Math.random()*0.6+0.2}));
function menuAnim(){
  if(document.getElementById('menu-screen').style.display !== 'none'){
    mctx.clearRect(0,0,ms.width,ms.height);
    mctx.fillStyle = '#fff';
    mStars.forEach(s=>{
      mctx.fillRect(s.x, s.y, s.s, s.s);
      s.y += s.v;
      if(s.y > ms.height){ s.y = -5; s.x = Math.random()*ms.width; }
    });
  }
  requestAnimationFrame(menuAnim);
}
menuAnim();

/* ---------------------------
   Juego
   --------------------------- */
const canvas = document.getElementById('game-canvas');
const ctx = canvas.getContext('2d');
function resizeCanvas(){ canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
resizeCanvas();

let shipX = window.innerWidth/2 - 25;
let shipY = canvas.height - 120;
let shipSpeed = 8;
let score = 0;
let meteors = [];
let frames = 0;
let isPaused = false;
let isDead = false;
let moveL = false, moveR = false;
let animationId;

/* Ship collision size (approx) */
const shipRadius = 30;

function resetGame(){
  resizeCanvas();
  shipX = canvas.width/2 - 25;
  shipY = canvas.height - 120;
  shipSpeed = 8;
  score = 0;
  meteors = [];
  frames = 0;
  isPaused = false;
  isDead = false;
  document.getElementById('score').innerText = '0';
  document.getElementById('overlay-menu').style.display = 'none';
}

/* Controls (touch + mouse) */
function setupCtrl(id, side){
  const el = document.getElementById(id);
  el.addEventListener('touchstart', e=>{ e.preventDefault(); if(side==='L') moveL=true; else moveR=true; }, {passive: false});
  el.addEventListener('touchend', e=>{ e.preventDefault(); if(side==='L') moveL=false; else moveR=false; }, {passive: false});
  el.addEventListener('mousedown', e=>{ e.preventDefault(); if(side==='L') moveL=true; else moveR=true; });
  el.addEventListener('mouseup', e=>{ e.preventDefault(); if(side==='L') moveL=false; else moveR=false; });
  el.addEventListener('mouseleave', e=>{ e.preventDefault(); if(side==='L') moveL=false; else moveR=false; });
}
setupCtrl('l-btn','L'); setupCtrl('r-btn','R');

window.addEventListener('keydown', (e)=>{
  if(e.key === 'ArrowLeft') moveL = true;
  if(e.key === 'ArrowRight') moveR = true;
  if(e.key === 'Escape') { if(document.getElementById('general-modal').style.display==='flex') hideGeneral(); else togglePause(); }
});
window.addEventListener('keyup', (e)=>{
  if(e.key === 'ArrowLeft') moveL = false;
  if(e.key === 'ArrowRight') moveR = false;
});

/* Spawn meteor with random size and internal circles */
function spawnMeteor(){
  const r = Math.floor(Math.random() * 36) + 12; // radius 12 - 47
  const x = Math.random() * (canvas.width - r*2);
  // speed slightly depending on size (smaller = faster generally)
  const speedBase = 3 + Math.random()*2;
  const v = speedBase + (30 / (r+10)) + Math.min(4, score/60);
  // create 1-4 internal circles (craters / texture) with random position inside meteor
  const innerCount = Math.floor(Math.random()*4) + 1;
  const inner = [];
  for(let i=0;i<innerCount;i++){
    const rr = Math.max(2, Math.floor(r * (Math.random()*0.45 + 0.12))); // 12% - 57% of meteor radius but >=2
    // place inside meteor circle using polar coords
    const angle = Math.random()*Math.PI*2;
    const dist = Math.random()*(r - rr) * 0.7; // keep inside comfortably
    const dx = Math.cos(angle)*dist;
    const dy = Math.sin(angle)*dist;
    inner.push({dx, dy, rr});
  }
  meteors.push({x: x, y: -r*2, v: v, r: r, inner: inner, wobble: Math.random()*200});
}

/* game loop draw meteor with internal circles and gradient */
function drawMeteor(m){
  // meteor center
  const cx = m.x + m.r;
  const cy = m.y + m.r;
  // body gradient (radial)
  const grad = ctx.createRadialGradient(cx - m.r*0.2, cy - m.r*0.2, m.r*0.1, cx, cy, m.r);
  grad.addColorStop(0, '#d69b5d');
  grad.addColorStop(0.5, '#9a5e2e');
  grad.addColorStop(1, '#60381d');

  ctx.fillStyle = grad;
  ctx.beginPath();
  ctx.arc(cx, cy, m.r, 0, Math.PI*2);
  ctx.fill();

  // subtle dark outline
  ctx.lineWidth = Math.max(1, Math.round(m.r*0.06));
  ctx.strokeStyle = 'rgba(0,0,0,0.45)';
  ctx.stroke();

  // draw inner circles (craters / texture) with lighter/similar colors
  m.inner.forEach(ic=>{
    const icx = cx + ic.dx;
    const icy = cy + ic.dy;
    const igrad = ctx.createRadialGradient(icx - ic.rr*0.2, icy - ic.rr*0.2, ic.rr*0.1, icx, icy, ic.rr);
    igrad.addColorStop(0, 'rgba(255,210,160,0.95)');
    igrad.addColorStop(0.5, 'rgba(170,110,70,0.9)');
    igrad.addColorStop(1, 'rgba(120,70,40,0.65)');
    ctx.beginPath();
    ctx.arc(icx, icy, ic.rr, 0, Math.PI*2);
    ctx.fillStyle = igrad;
    ctx.fill();
    // small inner highlight
    ctx.beginPath();
    ctx.arc(icx - ic.rr*0.25, icy - ic.rr*0.25, Math.max(1, Math.round(ic.rr*0.25)), 0, Math.PI*2);
    ctx.fillStyle = 'rgba(255,230,200,0.6)';
    ctx.fill();
  });
}

/* Improved collision: meteor radius vs ship approx center */
function checkCollision(m){
  const shipCX = shipX + 25;
  const shipCY = canvas.height - 95;
  const meteorCX = m.x + m.r;
  const meteorCY = m.y + m.r;
  const dist = Math.hypot(shipCX - meteorCX, shipCY - meteorCY);
  return dist < (shipRadius + m.r * 0.85); // allow a little margin
}

/* main loop */
function gameLoop(){
  if(isPaused || isDead || document.getElementById('game-screen').style.display === 'none') return;

  ctx.clearRect(0,0,canvas.width,canvas.height);

  // background stars (simple parallax feel)
  ctx.fillStyle = 'rgba(255,255,255,0.02)';
  for(let s=0;s<2;s++){
    ctx.fillRect((frames*0.2 + s*200) % canvas.width, (s*120) % canvas.height, 1, 1);
  }

  // move ship
  if(moveL && shipX > 0) shipX -= shipSpeed;
  if(moveR && shipX < canvas.width - 50) shipX += shipSpeed;

  // draw ship (triangle)
  ctx.fillStyle = '#00ffcc';
  ctx.beginPath();
  ctx.moveTo(shipX+25, canvas.height-120);
  ctx.lineTo(shipX, canvas.height-70);
  ctx.lineTo(shipX+50, canvas.height-70);
  ctx.closePath();
  ctx.fill();

  // spawn meteors: spawnRate decreases as score increases
  const spawnRate = Math.max(8, 40 - Math.floor(score/6));
  if(frames % spawnRate === 0){
    spawnMeteor();
  }

  // update meteors
  for(let i = meteors.length - 1; i >= 0; i--){
    const m = meteors[i];
    // tiny horizontal wobble for more life
    m.wobble += 0.02 + Math.random()*0.01;
    m.x += Math.sin(m.wobble)*0.4;
    m.y += m.v;

    drawMeteor(m);

    if(checkCollision(m)){
      isDead = true;
      gameMusic.pause();
      document.getElementById('overlay-title').innerText = 'MORISTE BOT';
      document.getElementById('overlay-title').style.color = '#ff4444';
      document.getElementById('btn-resume').style.display = 'none';
      document.getElementById('overlay-menu').style.display = 'flex';
    }

    // off screen -> remove + increment score
    if(m.y - m.r > canvas.height + 60){
      meteors.splice(i,1);
      score++;
      document.getElementById('score').innerText = score;
    }
  }

  frames++;
  animationId = requestAnimationFrame(gameLoop);
}

/* start transition: menu -> juego */
function startToGame(){
  const trans = document.getElementById('transition-layer');
  trans.style.opacity = '1';
  setTimeout(()=>{
    document.getElementById('menu-screen').style.display = 'none';
    document.getElementById('game-screen').style.display = 'flex';
    fadeAudio(menuMusic, gameMusic);
    resetGame();
    trans.style.opacity = '0';
    cancelAnimationFrame(animationId);
    isPaused = false;
    isDead = false;
    gameLoop();
  },700);
}

/* back to menu */
function gameToMenu(){
  const trans = document.getElementById('transition-layer');
  trans.style.opacity = '1';
  setTimeout(()=>{
    document.getElementById('game-screen').style.display = 'none';
    document.getElementById('menu-screen').style.display = 'flex';
    document.getElementById('overlay-menu').style.display = 'none';
    fadeAudio(gameMusic, menuMusic);
    isPaused = false;
    isDead = false;
    cancelAnimationFrame(animationId);
    trans.style.opacity = '0';
  },700);
}

function togglePause(){
  if(isDead) return;
  isPaused = !isPaused;
  document.getElementById('overlay-menu').style.display = isPaused ? 'flex' : 'none';
  document.getElementById('overlay-title').innerText = 'PAUSA';
  document.getElementById('overlay-title').style.color = '#00ffcc';
  document.getElementById('btn-resume').style.display = 'block';
  if(isPaused) {
    gameMusic.pause();
    cancelAnimationFrame(animationId);
  } else {
    gameMusic.play().catch(()=>{});
    gameLoop();
  }
}

function restartGame(){
  resetGame();
  isDead = false;
  isPaused = false;
  document.getElementById('overlay-menu').style.display = 'none';
  gameMusic.currentTime = 0;
  gameMusic.play().catch(()=>{});
  cancelAnimationFrame(animationId);
  gameLoop();
}

/* resize handling */
window.addEventListener('resize', ()=>{
  resizeCanvas(); resizeMenuStars();
  shipX = Math.min(shipX, canvas.width-60);
});

/* modal general */
function showGeneral(){ document.getElementById('general-modal').style.display = 'flex'; menuMusic.pause(); }
function hideGeneral(){ document.getElementById('general-modal').style.display = 'none'; try{ menuMusic.play(); }catch(e){} }
function copyCreator(){
  if(navigator.clipboard){
    navigator.clipboard.writeText('PattitexTEC').then(()=> alert('Creado copiado: PattitexTEC')).catch(()=> alert('No se pudo copiar'));
  } else alert('Portapapeles no disponible');
}
function openSocial(){ window.open('https://www.tiktok.com/@Doryan5B','_blank'); }

/* start states */
document.getElementById('menu-screen').style.display = 'flex';
document.getElementById('game-screen').style.display = 'none';
document.addEventListener('click', ()=>{ menuMusic.play().catch(()=>{}); }, {once:true});
document.addEventListener('touchstart', ()=>{ menuMusic.play().catch(()=>{}); }, {once:true});
</script>
</body>
</html>